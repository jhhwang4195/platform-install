tosca_definitions_version: tosca_simple_yaml_1_0
imports:
   - custom_types/xos.yaml
description: swarm extensions to deployment, generated by platform-install
topology_template:
  node_templates:
 
# Images and flavors
{% for image in xos_images %}
    {{ image.name }}:
      type: tosca.nodes.Image
      properties:
        path: /opt/xos/images/{{ image.name }}.tar
        disk_format: TAR
        container_format: BARE
        tag: {{ image.tag }}
{% endfor %}
{% for flavor in deployment_flavors %}
    {{ flavor }}:
      type: tosca.nodes.Flavor
{% endfor %}
# Deployment - adds images/flavors to site defined in deployment.yaml
    {{ deployment_type }}:
      type: tosca.nodes.Deployment
      requirements:
{% for flavor in deployment_flavors %}
          - {{ flavor }}:
              node: {{ flavor }}
              relationship: tosca.relationships.SupportsFlavor
{% endfor %}
 
# Swarm Controller
    {{ site_name }}_{{ deployment_type }}_swarm:
      type: tosca.nodes.Controller
      requirements:
        - deployment:
            node: {{ deployment_type }}
            relationship: tosca.relationships.ControllerDeployment
      properties:
          backend_type: Swarm
          version: 17.05
          ## andrew   2017-08-04
          ## FIXME  Modify adminrc
          auth_url: {{ swarm_manager_url }}
          admin_user: admin
          admin_password: {{ keystone_admin_password }}
          admin_tenant: admin
          domain: Default
      ## andrew  2017-08-04
      ## FIXME  To remove following adminrc
      ## (-) artifacts:
      ## (-)     adminrc: /opt/cord_profile/admin-swarmrc.sh
 
 
# Site - adds swarm controller to site defined in deployment.yaml
    {{ site_name }}:
      type: tosca.nodes.Site
      properties:
          display_name: {{ site_humanname }}
          site_url: http://{{ site_name }}.opencloud.us/
          hosts_nodes: true
      requirements:
        - deployment:
            node: {{ deployment_type }}
            relationship: tosca.relationships.MemberOfDeployment
        - controller:
            node: {{ site_name }}_{{ deployment_type }}_swarm
            relationship: tosca.relationships.UsesController
